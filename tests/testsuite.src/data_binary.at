## Copyright (C) 2003-2012, 2014-2019, 2022-2023 Free Software Foundation, Inc.
## Written by Keisuke Nishida, Roger While, Simon Sobisch, Ron Norman
##
## This file is part of GnuCOBOL.
##
## The GnuCOBOL compiler is free software: you can redistribute it
## and/or modify it under the terms of the GNU General Public License
## as published by the Free Software Foundation, either version 3 of the
## License, or (at your option) any later version.
##
## GnuCOBOL is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with GnuCOBOL.  If not, see <https://www.gnu.org/licenses/>.

### GnuCOBOL Test Suite

# 2-4-8 big-endian

AT_SETUP([BINARY: 2-4-8 big-endian])
AT_KEYWORDS([binary])

AT_DATA([dump.c], [
#include <stdio.h>
#include <libcob.h>

COB_EXT_EXPORT int
dump (unsigned char *data)
{
  int i;
  for (i = 0; i < 8; i++)
    printf ("%02x", data[[i]]);
  puts ("");
  return 0;
}
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-dump.cob" > prog.cob])

AT_CHECK([$COMPILE_MODULE dump.c], [0], [], [])
AT_CHECK([$COMPILE -fbinary-size=2-4-8 \
                   -fbinary-byteorder=big-endian prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[0001202020202020
000c202020202020
007b202020202020
04d2202020202020
0000303920202020
0001e24020202020
0012d68720202020
00bc614e20202020
075bcd1520202020
00000000499602d2
00000002dfdc1c35
0000001cbe991a14
0000011f71fb04cb
00000b3a73ce2ff2
00007048860ddf79
000462d53c8abac0
002bdc545d6b4b87
01b69b4ba630f34e
ffff202020202020
fff4202020202020
ff85202020202020
fb2e202020202020
ffffcfc720202020
fffe1dc020202020
ffed297920202020
ff439eb220202020
f8a432eb20202020
ffffffffb669fd2e
fffffffd2023e3cb
ffffffe34166e5ec
fffffee08e04fb35
fffff4c58c31d00e
ffff8fb779f22087
fffb9d2ac3754540
ffd423aba294b479
fe4964b459cf0cb2
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-display.cob" > prog.cob])

AT_CHECK([$COMPILE -fbinary-size=2-4-8 \
                   -fbinary-byteorder=big-endian prog.cob -o prog2], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog2], [0],
[1
12
123
1234
12345
123456
1234567
12345678
123456789
1234567890
12345678901
123456789012
1234567890123
12345678901234
123456789012345
1234567890123456
12345678901234567
123456789012345678
-1
-12
-123
-1234
-12345
-123456
-1234567
-12345678
-123456789
-1234567890
-12345678901
-123456789012
-1234567890123
-12345678901234
-123456789012345
-1234567890123456
-12345678901234567
-123456789012345678
])

AT_CLEANUP


# 2-4-8 native

AT_SETUP([BINARY: 2-4-8 native])
AT_KEYWORDS([binary])

if test "x$COB_BIGENDIAN" = "xyes"; then
AT_CHECK([true])
else


AT_DATA([dump.c], [
#include <stdio.h>
#include <libcob.h>

COB_EXT_EXPORT int
dump (unsigned char *data)
{
  int i;
  for (i = 0; i < 8; i++)
    printf ("%02x", data[[i]]);
  puts ("");
  return 0;
}
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-dump.cob" > prog.cob])

AT_CHECK([$COMPILE_MODULE dump.c], [0], [], [])
AT_CHECK([$COMPILE -fbinary-size=2-4-8 \
                   -fbinary-byteorder=native  prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[0100202020202020
0c00202020202020
7b00202020202020
d204202020202020
3930000020202020
40e2010020202020
87d6120020202020
4e61bc0020202020
15cd5b0720202020
d202964900000000
351cdcdf02000000
141a99be1c000000
cb04fb711f010000
f22fce733a0b0000
79df0d8648700000
c0ba8a3cd5620400
874b6b5d54dc2b00
4ef330a64b9bb601
ffff202020202020
f4ff202020202020
85ff202020202020
2efb202020202020
c7cfffff20202020
c01dfeff20202020
7929edff20202020
b29e43ff20202020
eb32a4f820202020
2efd69b6ffffffff
cbe32320fdffffff
ece56641e3ffffff
35fb048ee0feffff
0ed0318cc5f4ffff
8720f279b78fffff
404575c32a9dfbff
79b494a2ab23d4ff
b20ccf59b46449fe
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000202020202020
0000202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-display.cob" > prog.cob])

AT_CHECK([$COMPILE -fbinary-size=2-4-8 \
                   -fbinary-byteorder=native prog.cob -o prog2], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog2], [0],
[1
12
123
1234
12345
123456
1234567
12345678
123456789
1234567890
12345678901
123456789012
1234567890123
12345678901234
123456789012345
1234567890123456
12345678901234567
123456789012345678
-1
-12
-123
-1234
-12345
-123456
-1234567
-12345678
-123456789
-1234567890
-12345678901
-123456789012
-1234567890123
-12345678901234
-123456789012345
-1234567890123456
-12345678901234567
-123456789012345678
])
fi

AT_CLEANUP


# 1-2-4-8 big-endian

AT_SETUP([BINARY: 1-2-4-8 big-endian])
AT_KEYWORDS([binary])

AT_DATA([dump.c], [
#include <stdio.h>
#include <libcob.h>

COB_EXT_EXPORT int
dump (unsigned char *data)
{
  int i;
  for (i = 0; i < 8; i++)
    printf ("%02x", data[[i]]);
  puts ("");
  return 0;
}
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-dump.cob" > prog.cob])

AT_CHECK([$COMPILE_MODULE dump.c], [0], [], [])
AT_CHECK([$COMPILE -fbinary-size=1-2-4-8 \
                   -fbinary-byteorder=big-endian prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[0120202020202020
0c20202020202020
007b202020202020
04d2202020202020
0000303920202020
0001e24020202020
0012d68720202020
00bc614e20202020
075bcd1520202020
00000000499602d2
00000002dfdc1c35
0000001cbe991a14
0000011f71fb04cb
00000b3a73ce2ff2
00007048860ddf79
000462d53c8abac0
002bdc545d6b4b87
01b69b4ba630f34e
ff20202020202020
f420202020202020
ff85202020202020
fb2e202020202020
ffffcfc720202020
fffe1dc020202020
ffed297920202020
ff439eb220202020
f8a432eb20202020
ffffffffb669fd2e
fffffffd2023e3cb
ffffffe34166e5ec
fffffee08e04fb35
fffff4c58c31d00e
ffff8fb779f22087
fffb9d2ac3754540
ffd423aba294b479
fe4964b459cf0cb2
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-display.cob" > prog.cob])

AT_CHECK([$COMPILE -fbinary-size=1-2-4-8 \
                   -fbinary-byteorder=big-endian prog.cob -o prog2], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog2], [0],
[1
12
123
1234
12345
123456
1234567
12345678
123456789
1234567890
12345678901
123456789012
1234567890123
12345678901234
123456789012345
1234567890123456
12345678901234567
123456789012345678
-1
-12
-123
-1234
-12345
-123456
-1234567
-12345678
-123456789
-1234567890
-12345678901
-123456789012
-1234567890123
-12345678901234
-123456789012345
-1234567890123456
-12345678901234567
-123456789012345678
])

AT_CLEANUP


# 1-2-4-8 native

AT_SETUP([BINARY: 1-2-4-8 native])
AT_KEYWORDS([binary])

if test "x$COB_BIGENDIAN" = "xyes"; then
AT_CHECK([true])
else

AT_DATA([dump.c], [
#include <stdio.h>
#include <libcob.h>

COB_EXT_EXPORT int
dump (unsigned char *data)
{
  int i;
  for (i = 0; i < 8; i++)
    printf ("%02x", data[[i]]);
  puts ("");
  return 0;
}
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-dump.cob" > prog.cob])

AT_CHECK([$COMPILE_MODULE dump.c], [0], [], [])
AT_CHECK([$COMPILE -fbinary-size=1-2-4-8 \
                   -fbinary-byteorder=native prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[0120202020202020
0c20202020202020
7b00202020202020
d204202020202020
3930000020202020
40e2010020202020
87d6120020202020
4e61bc0020202020
15cd5b0720202020
d202964900000000
351cdcdf02000000
141a99be1c000000
cb04fb711f010000
f22fce733a0b0000
79df0d8648700000
c0ba8a3cd5620400
874b6b5d54dc2b00
4ef330a64b9bb601
ff20202020202020
f420202020202020
85ff202020202020
2efb202020202020
c7cfffff20202020
c01dfeff20202020
7929edff20202020
b29e43ff20202020
eb32a4f820202020
2efd69b6ffffffff
cbe32320fdffffff
ece56641e3ffffff
35fb048ee0feffff
0ed0318cc5f4ffff
8720f279b78fffff
404575c32a9dfbff
79b494a2ab23d4ff
b20ccf59b46449fe
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000020202020
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-display.cob" > prog.cob])

AT_CHECK([$COMPILE -fbinary-size=1-2-4-8 \
                   -fbinary-byteorder=native prog.cob -o prog2], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog2], [0],
[1
12
123
1234
12345
123456
1234567
12345678
123456789
1234567890
12345678901
123456789012
1234567890123
12345678901234
123456789012345
1234567890123456
12345678901234567
123456789012345678
-1
-12
-123
-1234
-12345
-123456
-1234567
-12345678
-123456789
-1234567890
-12345678901
-123456789012
-1234567890123
-12345678901234
-123456789012345
-1234567890123456
-12345678901234567
-123456789012345678
])

fi

AT_CLEANUP


# 1--8 big-endian

AT_SETUP([BINARY: 1--8 big-endian])
AT_KEYWORDS([binary])

AT_DATA([dump.c], [
#include <stdio.h>
#include <libcob.h>

COB_EXT_EXPORT int
dump (unsigned char *data)
{
  int i;
  for (i = 0; i < 8; i++)
    printf ("%02x", data[[i]]);
  puts ("");
  return 0;
}
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-dump.cob" > prog.cob])

AT_CHECK([$COMPILE_MODULE dump.c], [0], [], [])
AT_CHECK([$COMPILE -fbinary-size=1--8 \
                   -fbinary-byteorder=big-endian prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[0120202020202020
0c20202020202020
007b202020202020
04d2202020202020
0030392020202020
01e2402020202020
12d6872020202020
00bc614e20202020
075bcd1520202020
00499602d2202020
02dfdc1c35202020
1cbe991a14202020
011f71fb04cb2020
0b3a73ce2ff22020
007048860ddf7920
0462d53c8abac020
002bdc545d6b4b87
01b69b4ba630f34e
ff20202020202020
f420202020202020
ff85202020202020
fb2e202020202020
ffcfc72020202020
fe1dc02020202020
ffed297920202020
ff439eb220202020
f8a432eb20202020
ffb669fd2e202020
fd2023e3cb202020
ffe34166e5ec2020
fee08e04fb352020
f4c58c31d00e2020
ff8fb779f2208720
fb9d2ac375454020
ffd423aba294b479
fe4964b459cf0cb2
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-display.cob" > prog.cob])

AT_CHECK([$COMPILE -fbinary-size=1--8 \
                   -fbinary-byteorder=big-endian prog.cob -o prog2], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog2], [0],
[1
12
123
1234
12345
123456
1234567
12345678
123456789
1234567890
12345678901
123456789012
1234567890123
12345678901234
123456789012345
1234567890123456
12345678901234567
123456789012345678
-1
-12
-123
-1234
-12345
-123456
-1234567
-12345678
-123456789
-1234567890
-12345678901
-123456789012
-1234567890123
-12345678901234
-123456789012345
-1234567890123456
-12345678901234567
-123456789012345678
])

AT_CLEANUP


# 1--8 native

AT_SETUP([BINARY: 1--8 native])
AT_KEYWORDS([binary])

if test "x$COB_BIGENDIAN" = "xyes"; then
AT_CHECK([true])
else

AT_DATA([dump.c], [
#include <stdio.h>
#include <libcob.h>

COB_EXT_EXPORT int
dump (unsigned char *data)
{
  int i;
  for (i = 0; i < 8; i++)
    printf ("%02x", data[[i]]);
  puts ("");
  return 0;
}
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-dump.cob" > prog.cob])

AT_CHECK([$COMPILE_MODULE dump.c], [0], [], [])
AT_CHECK([$COMPILE -fbinary-size=1--8 \
                   -fbinary-byteorder=native prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[0120202020202020
0c20202020202020
7b00202020202020
d204202020202020
3930002020202020
40e2012020202020
87d6122020202020
4e61bc0020202020
15cd5b0720202020
d202964900202020
351cdcdf02202020
141a99be1c202020
cb04fb711f012020
f22fce733a0b2020
79df0d8648700020
c0ba8a3cd5620420
874b6b5d54dc2b00
4ef330a64b9bb601
ff20202020202020
f420202020202020
85ff202020202020
2efb202020202020
c7cfff2020202020
c01dfe2020202020
7929edff20202020
b29e43ff20202020
eb32a4f820202020
2efd69b6ff202020
cbe32320fd202020
ece56641e3ff2020
35fb048ee0fe2020
0ed0318cc5f42020
8720f279b78fff20
404575c32a9dfb20
79b494a2ab23d4ff
b20ccf59b46449fe
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
0020202020202020
0020202020202020
0000202020202020
0000202020202020
0000002020202020
0000002020202020
0000000020202020
0000000020202020
0000000020202020
0000000000202020
0000000000202020
0000000000002020
0000000000002020
0000000000002020
0000000000000020
0000000000000020
0000000000000000
0000000000000000
])

AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-display.cob" > prog.cob])

AT_CHECK([$COMPILE -fbinary-size=1--8 \
                   -fbinary-byteorder=native prog.cob -o prog2], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog2], [0],
[1
12
123
1234
12345
123456
1234567
12345678
123456789
1234567890
12345678901
123456789012
1234567890123
12345678901234
123456789012345
1234567890123456
12345678901234567
123456789012345678
-1
-12
-123
-1234
-12345
-123456
-1234567
-12345678
-123456789
-1234567890
-12345678901
-123456789012
-1234567890123
-12345678901234
-123456789012345
-1234567890123456
-12345678901234567
-123456789012345678
])

fi

AT_CLEANUP


# full-print

AT_SETUP([BINARY: full-print])
AT_KEYWORDS([binary])


AT_CHECK([sed -e 's/@USAGE@/BINARY/' "${TEMPLATE}/numeric-display.cob" > prog.cob])

AT_CHECK([$COMPILE -fbinary-size=1--8 \
                   -fno-pretty-display prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[001
012
00123
01234
00012345
00123456
01234567
0012345678
0123456789
0001234567890
0012345678901
0123456789012
001234567890123
012345678901234
00123456789012345
01234567890123456
00012345678901234567
00123456789012345678
-001
-012
-00123
-01234
-00012345
-00123456
-0001234567
-0012345678
-0123456789
-0001234567890
-0012345678901
-000123456789012
-001234567890123
-012345678901234
-00123456789012345
-01234567890123456
-00012345678901234567
-00123456789012345678
])

AT_CLEANUP


# 64bit unsigned

AT_SETUP([BINARY: 64bit unsigned compare])
AT_KEYWORDS([binary])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01 BDU-1         USAGE BINARY-DOUBLE UNSIGNED.
       01 BDU-2         USAGE BINARY-DOUBLE UNSIGNED.
       PROCEDURE        DIVISION.
           MOVE 18446744073709551615 TO BDU-1 BDU-2
           IF BDU-1 NOT EQUAL BDU-2 THEN
              DISPLAY "FAIL".
           STOP RUN.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [], [])

# also check "not optimized during codegen",
# which leads to other code-paths
AT_CHECK([$COMPILE -fno-fast-compare -C -o progalt.c prog.cob], [0], [], [])
AT_CHECK([$COMPILE progalt.c], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./progalt], [0], [], [])

AT_CLEANUP


# bug #173 unsigned values were treated as signed
AT_SETUP([BINARY: 64bit unsigned arithmetic notrunc])
AT_KEYWORDS([binary])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01 WORK-UDWORD-1 PIC 9(18) COMP.
       PROCEDURE        DIVISION.
           MOVE 18446744073709551615 TO WORK-UDWORD-1.
           DISPLAY WORK-UDWORD-1.
           COMPUTE  WORK-UDWORD-1 = WORK-UDWORD-1 / 2.
           DISPLAY WORK-UDWORD-1.
           STOP RUN.
])

AT_CHECK([$COMPILE -fnotrunc prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [18446744073709551615
09223372036854775807
], [])

AT_CLEANUP


# bug #197 64bit signed values did not accept min value constant
# recognized and logged in bug #384: assignment overflow
AT_SETUP([BINARY: 64bit signed negative constant range])
AT_KEYWORDS([binary])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01 WORK-DWORD-1  PIC S9(18) COMP-5 VALUE -9223372036854775808.
       PROCEDURE        DIVISION.
           DISPLAY WORK-DWORD-1 WITH NO ADVANCING.
           STOP RUN.
])

AT_CHECK([$COMPILE -fnotrunc prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [-09223372036854775808], [])

AT_CLEANUP


AT_SETUP([COMP-4 Truncate])
AT_KEYWORDS([binary numeric])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.

       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01  RANDOM-ORIGIN-B                     PIC 9V99 COMP-4.
       01  RANDOM-TARGET-B                     PIC V99  COMP-4.
       01  RANDOM-ORIGIN-D                     PIC 9V99 DISPLAY.
       01  RANDOM-TARGET-D                     PIC V99  DISPLAY.

       PROCEDURE DIVISION.
           MOVE 0.12            TO RANDOM-ORIGIN-D
           MOVE RANDOM-ORIGIN-D TO RANDOM-TARGET-D
           MOVE 0.12            TO RANDOM-ORIGIN-B
           MOVE RANDOM-ORIGIN-B TO RANDOM-TARGET-B
           IF RANDOM-ORIGIN-D <> RANDOM-ORIGIN-B
             DISPLAY "ORIGIN 0.12 WRONG"
             DISPLAY "DISPLAY: " RANDOM-ORIGIN-D
                " !=  BINARY : " RANDOM-ORIGIN-B
           END-IF.
           IF RANDOM-TARGET-D <> RANDOM-TARGET-B
             DISPLAY "TARGET  .12 WRONG"
             DISPLAY "DISPLAY: " RANDOM-TARGET-D
                " !=  BINARY : " RANDOM-TARGET-B
           ELSE
             DISPLAY "Ok with " RANDOM-TARGET-D " == " RANDOM-TARGET-B
           END-IF.

           MOVE 9.85            TO RANDOM-ORIGIN-D
           MOVE RANDOM-ORIGIN-D TO RANDOM-TARGET-D
           MOVE 9.85            TO RANDOM-ORIGIN-B
           MOVE RANDOM-ORIGIN-B TO RANDOM-TARGET-B
           IF RANDOM-ORIGIN-D <> RANDOM-ORIGIN-B
             DISPLAY "ORIGIN 9.85 WRONG"
             DISPLAY "DISPLAY: " RANDOM-ORIGIN-D
                " !=  BINARY : " RANDOM-ORIGIN-B
           END-IF.
           IF RANDOM-TARGET-D <> RANDOM-TARGET-B
             DISPLAY "TARGET  .85 WRONG"
             DISPLAY "DISPLAY: " RANDOM-TARGET-D
                " !=  BINARY : " RANDOM-TARGET-B
           ELSE
             DISPLAY "Ok with " RANDOM-TARGET-D " == " RANDOM-TARGET-B
           END-IF.
           STOP RUN.
])

AT_CHECK([$COMPILE -w prog.cob], [0], [], [])

AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[Ok with .12 == .12
Ok with .85 == .85
], [])

AT_CLEANUP


AT_SETUP([COMP-4 No Truncate])
AT_KEYWORDS([binary numeric])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.

       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01  RANDOM-ORIGIN-B                     PIC 9V99 COMP-4.
       01  RANDOM-TARGET-B                     PIC V99  COMP-4.
       01  RANDOM-ORIGIN-D                     PIC 9V99 DISPLAY.
       01  RANDOM-TARGET-D                     PIC V99  DISPLAY.
       01  FILLER       USAGE BINARY-INT VALUE 0.
           88 DO-DISP   VALUE 0.
           88 NO-DISP   VALUE 1.
       REPLACE ==DISPLAY== BY ==IF DO-DISP  DISPLAY==,
               ==END-DISPLAY== BY ==END-DISPLAY END-IF==.
       PROCEDURE        DIVISION.
       MAIN.
      *    Test with DISPLAY on error
           PERFORM DO-CHECK.
       >> IF CHECK-PERF IS DEFINED
           SET  NO-DISP    TO TRUE
      *    some performance checks on the way...
           PERFORM DO-CHECK 30000 TIMES.
       >> END-IF
           GOBACK.

       DO-CHECK.
           MOVE 0.12            TO RANDOM-ORIGIN-D
           MOVE RANDOM-ORIGIN-D TO RANDOM-TARGET-D
           MOVE 0.12            TO RANDOM-ORIGIN-B
           MOVE RANDOM-ORIGIN-B TO RANDOM-TARGET-B
           IF RANDOM-ORIGIN-D <> RANDOM-ORIGIN-B
             DISPLAY "ORIGIN 0.12 WRONG"
             END-DISPLAY
             DISPLAY "DISPLAY: " RANDOM-ORIGIN-D
                " !=  BINARY : " RANDOM-ORIGIN-B
             END-DISPLAY
           END-IF.
           IF RANDOM-TARGET-D <> RANDOM-TARGET-B
             DISPLAY "TARGET  .12 WRONG"
             END-DISPLAY
             DISPLAY "DISPLAY: " RANDOM-TARGET-D
                " !=  BINARY : " RANDOM-TARGET-B
             END-DISPLAY
           ELSE
             DISPLAY "Ok with " RANDOM-TARGET-D " == " RANDOM-TARGET-B
             END-DISPLAY
           END-IF.

           MOVE 9.85            TO RANDOM-ORIGIN-D
           MOVE RANDOM-ORIGIN-D TO RANDOM-TARGET-D
           MOVE 9.85            TO RANDOM-ORIGIN-B
           MOVE RANDOM-ORIGIN-B TO RANDOM-TARGET-B
           IF RANDOM-ORIGIN-D <> RANDOM-ORIGIN-B
             DISPLAY "ORIGIN 9.85 WRONG"
             END-DISPLAY
             DISPLAY "DISPLAY: " RANDOM-ORIGIN-D
                " !=  BINARY : " RANDOM-ORIGIN-B
             END-DISPLAY
           END-IF.
           IF RANDOM-TARGET-D <> RANDOM-TARGET-B
             DISPLAY "TARGET  .85 WRONG"
             END-DISPLAY
             DISPLAY "DISPLAY: " RANDOM-TARGET-D
                " !=  BINARY : " RANDOM-TARGET-B
             END-DISPLAY
           ELSE
             DISPLAY "Ok with " RANDOM-TARGET-D " == " RANDOM-TARGET-B
             END-DISPLAY
           END-IF.
])

AT_CHECK([$COMPILE -w -fnotrunc prog.cob], [0], [], [])

AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[Ok with 12 == 012
TARGET  .85 WRONG
DISPLAY: 85 !=  BINARY : 217
], [])

AT_CLEANUP


AT_SETUP([MOVE DISPLAY to BINARY])
AT_KEYWORDS([fundamental PPP])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  D-S99V99     PIC S99V99 DISPLAY VALUE  1.23.
       01  D-N99V99     PIC S99V99 DISPLAY VALUE -1.32.
       01  D-9V99       PIC   9V99 DISPLAY VALUE  1.1.
       01  D-S99        PIC S99    DISPLAY VALUE  12.
       01  D-99         PIC  99    DISPLAY VALUE  2.
       01  D-P99        PIC P99    DISPLAY VALUE  0.02.
       01  D-9PP        PIC 9PP    DISPLAY VALUE  200.
       01  D-938        PIC 9(38)  DISPLAY VALUE
           12345678901234567890123456789012345678.
       01  P-S99V99     PIC S99V99 BINARY.
       01  P-99V9       PIC  99V9  BINARY.
       01  P-S999       PIC S999   BINARY.
       01  P-99         PIC  99    BINARY.
       01  P-P9         PIC  P9    BINARY.
       01  P-9P         PIC  9P    BINARY.
       01  FILLER       USAGE BINARY-INT VALUE 0.
           88 DO-DISP   VALUE 0.
           88 NO-DISP   VALUE 1.
       REPLACE ==DISPLAY== BY ==IF DO-DISP  DISPLAY==.

       PROCEDURE        DIVISION.
       MAIN.
      *    Test with DISPLAY on error
           PERFORM DO-CHECK.
       >> IF CHECK-PERF IS DEFINED
           SET  NO-DISP    TO TRUE
      *    some performance checks on the way...
           PERFORM DO-CHECK 20000 TIMES.
       >> END-IF
           GOBACK.

       DO-CHECK.
       
           MOVE D-938 TO P-99
           IF P-99     NOT = 78
              DISPLAY "P-99: " P-99.

           MOVE D-S99V99 TO P-S99V99
           IF P-S99V99 NOT = 1.23
              DISPLAY "P-S99V99 1: " P-S99V99.
           MOVE D-N99V99 TO P-S99V99
           IF P-S99V99 NOT = -1.32
              DISPLAY "P-S99V99 2: " P-S99V99.
           MOVE D-9V99   TO P-S99V99
           IF P-S99V99 NOT = 1.1
              DISPLAY "P-S99V99 3: " P-S99V99.
           MOVE D-S99    TO P-S99V99
           IF P-S99V99 NOT = 12
              DISPLAY "P-S99V99 4: " P-S99V99.
           MOVE D-99     TO P-S99V99
           IF P-S99V99 NOT = 2
              DISPLAY "P-S99V99 5: " P-S99V99.
           MOVE D-P99    TO P-S99V99
           IF P-S99V99 NOT = 0.02
              DISPLAY "P-S99V99 6: " P-S99V99.
           MOVE D-9PP    TO P-S99V99
           IF P-S99V99 NOT = 0
              DISPLAY "P-S99V99 7: " P-S99V99.

           MOVE D-S99V99 TO P-99V9 
           IF P-99V9  NOT = 1.2
              DISPLAY "P-99V99  1: " P-99V9  .
           MOVE D-N99V99 TO P-99V9 
           IF P-99V9  NOT = 1.3
              DISPLAY "P-99V99  2: " P-99V9  .
           MOVE D-9V99   TO P-99V9 
           IF P-99V9  NOT = 1.1
              DISPLAY "P-99V99  3: " P-99V9  .
           MOVE D-S99    TO P-99V9 
           IF P-99V9  NOT = 12
              DISPLAY "P-99V99  4: " P-99V9  .
           MOVE D-99     TO P-99V9 
           IF P-99V9  NOT = 2
              DISPLAY "P-99V99  5: " P-99V9  .
           MOVE D-P99    TO P-99V9 
           IF P-99V9  NOT = 0
              DISPLAY "P-99V99  6: " P-99V9  .
           MOVE D-9PP    TO P-99V9 
           IF P-99V9  NOT = 0
              DISPLAY "P-99V99  7: " P-99V9  .

           MOVE D-S99V99 TO P-S999
           IF P-S999   NOT = 1
              DISPLAY "P-S999   1: " P-S999  .
           MOVE D-N99V99 TO P-S999
           IF P-S999   NOT = -1
              DISPLAY "P-S999   2: " P-S999  .
           MOVE D-9V99   TO P-S999
           IF P-S999   NOT = 1
              DISPLAY "P-S999   3: " P-S999  .
           MOVE D-S99    TO P-S999
           IF P-S999   NOT = 12
              DISPLAY "P-S999   4: " P-S999  .
           MOVE D-99     TO P-S999
           IF P-S999   NOT = 2
              DISPLAY "P-S999   5: " P-S999  .
           MOVE D-P99    TO P-S999
           IF P-S999   NOT = 0
              DISPLAY "P-S999   6: " P-S999  .
           MOVE D-9PP    TO P-S999
           IF P-S999   NOT = 200
              DISPLAY "P-S999   7: " P-S999  .

           MOVE D-S99V99 TO P-99
           IF P-99     NOT = 1
              DISPLAY "P-99     1: " P-99    .
           MOVE D-N99V99 TO P-99
           IF P-99     NOT = 1
              DISPLAY "P-99     2: " P-99    .
           MOVE D-9V99   TO P-99
           IF P-99     NOT = 1
              DISPLAY "P-99     3: " P-99    .
           MOVE D-S99    TO P-99
           IF P-99     NOT = 12
              DISPLAY "P-99     4: " P-99    .
           MOVE D-99     TO P-99
           IF P-99     NOT = 2
              DISPLAY "P-99     5: " P-99    .
           MOVE D-P99    TO P-99
           IF P-99     NOT = 0
              DISPLAY "P-99     6: " P-99    .
           MOVE D-9PP    TO P-99
           IF P-99     NOT = 0
              DISPLAY "P-99     7: " P-99    .

           MOVE D-S99V99 TO P-P9
           IF P-P9     NOT = 0.03
              DISPLAY "P-P9     1: " P-P9    .
           MOVE D-N99V99 TO P-P9
           IF P-P9     NOT = 0.02
              DISPLAY "P-P9     2: " P-P9    .
           MOVE D-9V99   TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     3: " P-P9    .
           MOVE D-S99    TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     4: " P-P9    .
           MOVE D-99     TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     5: " P-P9    .
           MOVE D-P99    TO P-P9
           IF P-P9     NOT = 0.02
              DISPLAY "P-P9     6: " P-P9    .
           MOVE D-9PP    TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     7: " P-P9    .

           MOVE D-S99V99 TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     1: " P-9P    .
           MOVE D-N99V99 TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     2: " P-9P    .
           MOVE D-9V99   TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     3: " P-9P    .
           MOVE D-S99    TO P-9P
           IF P-9P     NOT = 10
              DISPLAY "P-9P     4: " P-9P    .
           MOVE D-99     TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     5: " P-9P    .
           MOVE D-P99    TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     6: " P-9P    .
           MOVE D-9PP    TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     7: " P-9P    .

           CONTINUE.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [])

AT_CLEANUP


AT_SETUP([MOVE PACKED-DECIMAL to BINARY])
AT_KEYWORDS([fundamental PPP])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  P-S99V99     PIC S99V99 PACKED-DECIMAL VALUE  1.23.
       01  P-N99V99     PIC S99V99 PACKED-DECIMAL VALUE -1.32.
       01  P-9V99       PIC   9V99 PACKED-DECIMAL VALUE  1.1.
       01  P-S99        PIC S99    PACKED-DECIMAL VALUE  12.
       01  P-99         PIC  99    PACKED-DECIMAL VALUE  2.
       01  P-P99        PIC P99    PACKED-DECIMAL VALUE  0.02.
       01  P-9PP        PIC 9PP    PACKED-DECIMAL VALUE  200.
       01  P-938        PIC 9(38)  PACKED-DECIMAL VALUE
           12345678901234567890123456789012345678.
       01  B-S99V99     PIC S99V99 BINARY.
       01  B-99V9       PIC  99V9  BINARY.
       01  B-S999       PIC S999   BINARY.
       01  B-99         PIC  99    BINARY.
       01  B-P9         PIC  P9    BINARY.
       01  B-9P         PIC  9P    BINARY.
       01  FILLER       USAGE BINARY-INT VALUE 0.
           88 DO-DISP   VALUE 0.
           88 NO-DISP   VALUE 1.
       REPLACE ==DISPLAY== BY ==IF DO-DISP  DISPLAY==.

       PROCEDURE        DIVISION.
       MAIN.
      *    Test with DISPLAY on error
           PERFORM DO-CHECK.
       >> IF CHECK-PERF IS DEFINED
           SET  NO-DISP    TO TRUE
      *    some performance checks on the way...
           PERFORM DO-CHECK 20000 TIMES.
       >> END-IF
           GOBACK.

       DO-CHECK.
       
           MOVE P-938 TO B-99
           IF B-99     NOT = 78
              DISPLAY "B-99: " B-99.

           MOVE P-S99V99 TO B-S99V99
           IF B-S99V99 NOT = 1.23
              DISPLAY "B-S99V99 1: " B-S99V99.
           MOVE P-N99V99 TO B-S99V99
           IF B-S99V99 NOT = -1.32
              DISPLAY "B-S99V99 2: " B-S99V99.
           MOVE P-9V99   TO B-S99V99
           IF B-S99V99 NOT = 1.1
              DISPLAY "B-S99V99 3: " B-S99V99.
           MOVE P-S99    TO B-S99V99
           IF B-S99V99 NOT = 12
              DISPLAY "B-S99V99 4: " B-S99V99.
           MOVE P-99     TO B-S99V99
           IF B-S99V99 NOT = 2
              DISPLAY "B-S99V99 5: " B-S99V99.
           MOVE P-P99    TO B-S99V99
           IF B-S99V99 NOT = 0.02
              DISPLAY "B-S99V99 6: " B-S99V99.
           MOVE P-9PP    TO B-S99V99
           IF B-S99V99 NOT = 0
              DISPLAY "B-S99V99 7: " B-S99V99.

           MOVE P-S99V99 TO B-99V9 
           IF B-99V9  NOT = 1.2
              DISPLAY "B-99V99  1: " B-99V9  .
           MOVE P-N99V99 TO B-99V9 
           IF B-99V9  NOT = 1.3
              DISPLAY "B-99V99  2: " B-99V9  .
           MOVE P-9V99   TO B-99V9 
           IF B-99V9  NOT = 1.1
              DISPLAY "B-99V99  3: " B-99V9  .
           MOVE P-S99    TO B-99V9 
           IF B-99V9  NOT = 12
              DISPLAY "B-99V99  4: " B-99V9  .
           MOVE P-99     TO B-99V9 
           IF B-99V9  NOT = 2
              DISPLAY "B-99V99  5: " B-99V9  .
           MOVE P-P99    TO B-99V9 
           IF B-99V9  NOT = 0
              DISPLAY "B-99V99  6: " B-99V9  .
           MOVE P-9PP    TO B-99V9 
           IF B-99V9  NOT = 0
              DISPLAY "B-99V99  7: " B-99V9  .

           MOVE P-S99V99 TO B-S999
           IF B-S999   NOT = 1
              DISPLAY "B-S999   1: " B-S999  .
           MOVE P-N99V99 TO B-S999
           IF B-S999   NOT = -1
              DISPLAY "B-S999   2: " B-S999  .
           MOVE P-9V99   TO B-S999
           IF B-S999   NOT = 1
              DISPLAY "B-S999   3: " B-S999  .
           MOVE P-S99    TO B-S999
           IF B-S999   NOT = 12
              DISPLAY "B-S999   4: " B-S999  .
           MOVE P-99     TO B-S999
           IF B-S999   NOT = 2
              DISPLAY "B-S999   5: " B-S999  .
           MOVE P-P99    TO B-S999
           IF B-S999   NOT = 0
              DISPLAY "B-S999   6: " B-S999  .
           MOVE P-9PP    TO B-S999
           IF B-S999   NOT = 200
              DISPLAY "B-S999   7: " B-S999  .

           MOVE P-S99V99 TO B-99
           IF B-99     NOT = 1
              DISPLAY "B-99     1: " B-99    .
           MOVE P-N99V99 TO B-99
           IF B-99     NOT = 1
              DISPLAY "B-99     2: " B-99    .
           MOVE P-9V99   TO B-99
           IF B-99     NOT = 1
              DISPLAY "B-99     3: " B-99    .
           MOVE P-S99    TO B-99
           IF B-99     NOT = 12
              DISPLAY "B-99     4: " B-99    .
           MOVE P-99     TO B-99
           IF B-99     NOT = 2
              DISPLAY "B-99     5: " B-99    .
           MOVE P-P99    TO B-99
           IF B-99     NOT = 0
              DISPLAY "B-99     6: " B-99    .
           MOVE P-9PP    TO B-99
           IF B-99     NOT = 0
              DISPLAY "B-99     7: " B-99    .

           MOVE P-S99V99 TO B-P9
           IF B-P9     NOT = 0.03
              DISPLAY "B-P9     1: " B-P9    .
           MOVE P-N99V99 TO B-P9
           IF B-P9     NOT = 0.02
              DISPLAY "B-P9     2: " B-P9    .
           MOVE P-9V99   TO B-P9
           IF B-P9     NOT = 0
              DISPLAY "B-P9     3: " B-P9    .
           MOVE P-S99    TO B-P9
           IF B-P9     NOT = 0
              DISPLAY "B-P9     4: " B-P9    .
           MOVE P-99     TO B-P9
           IF B-P9     NOT = 0
              DISPLAY "B-P9     5: " B-P9    .
           MOVE P-P99    TO B-P9
           IF B-P9     NOT = 0.02
              DISPLAY "B-P9     6: " B-P9    .
           MOVE P-9PP    TO B-P9
           IF B-P9     NOT = 0
              DISPLAY "B-P9     7: " B-P9    .

           MOVE P-S99V99 TO B-9P
           IF B-9P     NOT = 0
              DISPLAY "B-9P     1: " B-9P    .
           MOVE P-N99V99 TO B-9P
           IF B-9P     NOT = 0
              DISPLAY "B-9P     2: " B-9P    .
           MOVE P-9V99   TO B-9P
           IF B-9P     NOT = 0
              DISPLAY "B-9P     3: " B-9P    .
           MOVE P-S99    TO B-9P
           IF B-9P     NOT = 10
              DISPLAY "B-9P     4: " B-9P    .
           MOVE P-99     TO B-9P
           IF B-9P     NOT = 0
              DISPLAY "B-9P     5: " B-9P    .
           MOVE P-P99    TO B-9P
           IF B-9P     NOT = 0
              DISPLAY "B-9P     6: " B-9P    .
           MOVE P-9PP    TO B-9P
           IF B-9P     NOT = 0
              DISPLAY "B-9P     7: " B-9P    .

           CONTINUE.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [])

AT_CLEANUP


AT_SETUP([MOVE BINARY to PACKED-DECIMAL])
AT_KEYWORDS([fundamental PPP])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  B-S99V99     PIC S99V99 BINARY VALUE  1.23.
       01  B-N99V99     PIC S99V99 BINARY VALUE -1.32.
       01  B-9V99       PIC   9V99 BINARY VALUE  1.1.
       01  B-S99        PIC S99    BINARY VALUE  12.
       01  B-99         PIC  99    BINARY VALUE  2.
       01  B-P99        PIC P99    BINARY VALUE  0.02.
       01  B-9PP        PIC 9PP    BINARY VALUE  200.
       01  P-S99V99     PIC S99V99 PACKED-DECIMAL.
       01  P-99V9       PIC  99V9  PACKED-DECIMAL.
       01  P-S999       PIC S999   PACKED-DECIMAL.
       01  P-99         PIC  99    PACKED-DECIMAL.
       01  P-P9         PIC  P9    PACKED-DECIMAL.
       01  P-9P         PIC  9P    PACKED-DECIMAL.
       01  FILLER       USAGE BINARY-INT VALUE 0.
           88 DO-DISP   VALUE 0.
           88 NO-DISP   VALUE 1.
       REPLACE ==DISPLAY== BY ==IF DO-DISP  DISPLAY==.

       PROCEDURE        DIVISION.
       MAIN.
      *    Test with DISPLAY on error
           PERFORM DO-CHECK.
       >> IF CHECK-PERF IS DEFINED
           SET  NO-DISP    TO TRUE
      *    some performance checks on the way...
           PERFORM DO-CHECK 20000 TIMES.
       >> END-IF
           GOBACK.

       DO-CHECK.

           MOVE B-S99V99 TO P-S99V99
           IF P-S99V99 NOT = 1.23
              DISPLAY "P-S99V99 1: " P-S99V99.
           MOVE B-N99V99 TO P-S99V99
           IF P-S99V99 NOT = -1.32
              DISPLAY "P-S99V99 2: " P-S99V99.
           MOVE B-9V99   TO P-S99V99
           IF P-S99V99 NOT = 1.1
              DISPLAY "P-S99V99 3: " P-S99V99.
           MOVE B-S99    TO P-S99V99
           IF P-S99V99 NOT = 12
              DISPLAY "P-S99V99 4: " P-S99V99.
           MOVE B-99     TO P-S99V99
           IF P-S99V99 NOT = 2
              DISPLAY "P-S99V99 5: " P-S99V99.
           MOVE B-P99    TO P-S99V99
           IF P-S99V99 NOT = 0.02
              DISPLAY "P-S99V99 6: " P-S99V99.
           MOVE B-9PP    TO P-S99V99
           IF P-S99V99 NOT = 0
              DISPLAY "P-S99V99 7: " P-S99V99.

           MOVE B-S99V99 TO P-99V9 
           IF P-99V9  NOT = 1.2
              DISPLAY "P-99V9   1: " P-99V9  .
           MOVE B-N99V99 TO P-99V9 
           IF P-99V9  NOT = 1.3
              DISPLAY "P-99V9   2: " P-99V9  .
           MOVE B-9V99   TO P-99V9 
           IF P-99V9  NOT = 1.1
              DISPLAY "P-99V9   3: " P-99V9  .
           MOVE B-S99    TO P-99V9 
           IF P-99V9  NOT = 12
              DISPLAY "P-99V9   4: " P-99V9  .
           MOVE B-99     TO P-99V9 
           IF P-99V9  NOT = 2
              DISPLAY "P-99V9   5: " P-99V9  .
           MOVE B-P99    TO P-99V9 
           IF P-99V9  NOT = 0
              DISPLAY "P-99V9   6: " P-99V9  .
           MOVE B-9PP    TO P-99V9 
           IF P-99V9  NOT = 0
              DISPLAY "P-99V9   7: " P-99V9  .

           MOVE B-S99V99 TO P-S999
           IF P-S999   NOT = 1
              DISPLAY "P-S999   1: " P-S999  .
           MOVE B-N99V99 TO P-S999
           IF P-S999   NOT = -1
              DISPLAY "P-S999   2: " P-S999  .
           MOVE B-9V99   TO P-S999
           IF P-S999   NOT = 1
              DISPLAY "P-S999   3: " P-S999  .
           MOVE B-S99    TO P-S999
           IF P-S999   NOT = 12
              DISPLAY "P-S999   4: " P-S999  .
           MOVE B-99     TO P-S999
           IF P-S999   NOT = 2
              DISPLAY "P-S999   5: " P-S999  .
           MOVE B-P99    TO P-S999
           IF P-S999   NOT = 0
              DISPLAY "P-S999   6: " P-S999  .
           MOVE B-9PP    TO P-S999
           IF P-S999   NOT = 200
              DISPLAY "P-S999   7: " P-S999  .

           MOVE B-S99V99 TO P-99
           IF P-99     NOT = 1
              DISPLAY "P-99     1: " P-99    .
           MOVE B-N99V99 TO P-99
           IF P-99     NOT = 1
              DISPLAY "P-99     2: " P-99    .
           MOVE B-9V99   TO P-99
           IF P-99     NOT = 1
              DISPLAY "P-99     3: " P-99    .
           MOVE B-S99    TO P-99
           IF P-99     NOT = 12
              DISPLAY "P-99     4: " P-99    .
           MOVE B-99     TO P-99
           IF P-99     NOT = 2
              DISPLAY "P-99     5: " P-99    .
           MOVE B-P99    TO P-99
           IF P-99     NOT = 0
              DISPLAY "P-99     6: " P-99    .
           MOVE B-9PP    TO P-99
           IF P-99     NOT = 0
              DISPLAY "P-99     7: " P-99    .

           MOVE B-S99V99 TO P-P9
           IF P-P9     NOT = 0.03
              DISPLAY "P-P9     1: " P-P9    .
           MOVE B-N99V99 TO P-P9
           IF P-P9     NOT = 0.02
              DISPLAY "P-P9     2: " P-P9    .
           MOVE B-9V99   TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     3: " P-P9    .
           MOVE B-S99    TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     4: " P-P9    .
           MOVE B-99     TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     5: " P-P9    .
           MOVE B-P99    TO P-P9
           IF P-P9     NOT = 0.02
              DISPLAY "P-P9     6: " P-P9    .
           MOVE B-9PP    TO P-P9
           IF P-P9     NOT = 0
              DISPLAY "P-P9     7: " P-P9    .

           MOVE B-S99V99 TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     1: " P-9P    .
           MOVE B-N99V99 TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     2: " P-9P    .
           MOVE B-9V99   TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     3: " P-9P    .
           MOVE B-S99    TO P-9P
           IF P-9P     NOT = 10
              DISPLAY "P-9P     4: " P-9P    .
           MOVE B-99     TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     5: " P-9P    .
           MOVE B-P99    TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     6: " P-9P    .
           MOVE B-9PP    TO P-9P
           IF P-9P     NOT = 0
              DISPLAY "P-9P     7: " P-9P    .

           CONTINUE.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [])

AT_CLEANUP


AT_SETUP([MOVE BINARY to BINARY])
AT_KEYWORDS([fundamental PPP])

# note: for changes mind the nearly identical test in data_display.at

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  B-S99V99     PIC S99V99 BINARY VALUE  1.23.
       01  B-N99V99     PIC S99V99 BINARY VALUE -1.32.
       01  B-9V99       PIC   9V99 BINARY VALUE  1.1.
       01  B-S99        PIC S99    BINARY VALUE  12.
       01  B-99         PIC  99    BINARY VALUE  2.
       01  B-P99        PIC P99    BINARY VALUE  0.02.
       01  B-9PP        PIC 9PP    BINARY VALUE  200.
       01  C-S99V99     PIC S99V99 BINARY.
       01  C-99V9       PIC  99V9  BINARY.
       01  C-S999       PIC S999   BINARY.
       01  C-99         PIC  99    BINARY.
       01  C-P9         PIC  P9    BINARY.
       01  C-9P         PIC  9P    BINARY.
       01  FILLER       USAGE BINARY-INT VALUE 0.
           88 DO-DISP   VALUE 0.
           88 NO-DISP   VALUE 1.
       REPLACE ==DISPLAY== BY ==IF DO-DISP  DISPLAY==.

       PROCEDURE        DIVISION.
       MAIN.
      *    Test with DISPLAY on error
           PERFORM DO-CHECK.
       >> IF CHECK-PERF IS DEFINED
           SET  NO-DISP    TO TRUE
      *    some performance checks on the way...
           PERFORM DO-CHECK 20000 TIMES.
       >> END-IF
           GOBACK.

       DO-CHECK.

           MOVE B-S99V99 TO C-S99V99
           IF C-S99V99 NOT = 1.23
              DISPLAY "C-S99V99 1: " C-S99V99.
           MOVE B-N99V99 TO C-S99V99
           IF C-S99V99 NOT = -1.32
              DISPLAY "C-S99V99 2: " C-S99V99.
           MOVE B-9V99   TO C-S99V99
           IF C-S99V99 NOT = 1.1
              DISPLAY "C-S99V99 3: " C-S99V99.
           MOVE B-S99    TO C-S99V99
           IF C-S99V99 NOT = 12
              DISPLAY "C-S99V99 4: " C-S99V99.
           MOVE B-99     TO C-S99V99
           IF C-S99V99 NOT = 2
              DISPLAY "C-S99V99 5: " C-S99V99.
           MOVE B-P99    TO C-S99V99
           IF C-S99V99 NOT = 0.02
              DISPLAY "C-S99V99 6: " C-S99V99.
           MOVE B-9PP    TO C-S99V99
           IF C-S99V99 NOT = 0
              DISPLAY "C-S99V99 7: " C-S99V99.

           MOVE B-S99V99 TO C-99V9 
           IF C-99V9  NOT = 1.2
              DISPLAY "C-99V9   1: " C-99V9  .
           MOVE B-N99V99 TO C-99V9 
           IF C-99V9  NOT = 1.3
              DISPLAY "C-99V9   2: " C-99V9  .
           MOVE B-9V99   TO C-99V9 
           IF C-99V9  NOT = 1.1
              DISPLAY "C-99V9   3: " C-99V9  .
           MOVE B-S99    TO C-99V9 
           IF C-99V9  NOT = 12
              DISPLAY "C-99V9   4: " C-99V9  .
           MOVE B-99     TO C-99V9 
           IF C-99V9  NOT = 2
              DISPLAY "C-99V9   5: " C-99V9  .
           MOVE B-P99    TO C-99V9 
           IF C-99V9  NOT = 0
              DISPLAY "C-99V9   6: " C-99V9  .
           MOVE B-9PP    TO C-99V9 
           IF C-99V9  NOT = 0
              DISPLAY "C-99V9   7: " C-99V9  .

           MOVE B-S99V99 TO C-S999
           IF C-S999   NOT = 1
              DISPLAY "C-S999   1: " C-S999  .
           MOVE B-N99V99 TO C-S999
           IF C-S999   NOT = -1
              DISPLAY "C-S999   2: " C-S999  .
           MOVE B-9V99   TO C-S999
           IF C-S999   NOT = 1
              DISPLAY "C-S999   3: " C-S999  .
           MOVE B-S99    TO C-S999
           IF C-S999   NOT = 12
              DISPLAY "C-S999   4: " C-S999  .
           MOVE B-99     TO C-S999
           IF C-S999   NOT = 2
              DISPLAY "C-S999   5: " C-S999  .
           MOVE B-P99    TO C-S999
           IF C-S999   NOT = 0
              DISPLAY "C-S999   6: " C-S999  .
           MOVE B-9PP    TO C-S999
           IF C-S999   NOT = 200
              DISPLAY "C-S999   7: " C-S999  .

           MOVE B-S99V99 TO C-99
           IF C-99     NOT = 1
              DISPLAY "C-99     1: " C-99    .
           MOVE B-N99V99 TO C-99
           IF C-99     NOT = 1
              DISPLAY "C-99     2: " C-99    .
           MOVE B-9V99   TO C-99
           IF C-99     NOT = 1
              DISPLAY "C-99     3: " C-99    .
           MOVE B-S99    TO C-99
           IF C-99     NOT = 12
              DISPLAY "C-99     4: " C-99    .
           MOVE B-99     TO C-99
           IF C-99     NOT = 2
              DISPLAY "C-99     5: " C-99    .
           MOVE B-P99    TO C-99
           IF C-99     NOT = 0
              DISPLAY "C-99     6: " C-99    .
           MOVE B-9PP    TO C-99
           IF C-99     NOT = 0
              DISPLAY "C-99     7: " C-99    .

           MOVE B-S99V99 TO C-P9
           IF C-P9     NOT = 0.03
              DISPLAY "C-P9     1: " C-P9    .
           MOVE B-N99V99 TO C-P9
           IF C-P9     NOT = 0.02
              DISPLAY "C-P9     2: " C-P9    .
           MOVE B-9V99   TO C-P9
           IF C-P9     NOT = 0
              DISPLAY "C-P9     3: " C-P9    .
           MOVE B-S99    TO C-P9
           IF C-P9     NOT = 0
              DISPLAY "C-P9     4: " C-P9    .
           MOVE B-99     TO C-P9
           IF C-P9     NOT = 0
              DISPLAY "C-P9     5: " C-P9    .
           MOVE B-P99    TO C-P9
           IF C-P9     NOT = 0.02
              DISPLAY "C-P9     6: " C-P9    .
           MOVE B-9PP    TO C-P9
           IF C-P9     NOT = 0
              DISPLAY "C-P9     7: " C-P9    .

           MOVE B-S99V99 TO C-9P
           IF C-9P     NOT = 0
              DISPLAY "C-9P     1: " C-9P    .
           MOVE B-N99V99 TO C-9P
           IF C-9P     NOT = 0
              DISPLAY "C-9P     2: " C-9P    .
           MOVE B-9V99   TO C-9P
           IF C-9P     NOT = 0
              DISPLAY "C-9P     3: " C-9P    .
           MOVE B-S99    TO C-9P
           IF C-9P     NOT = 10
              DISPLAY "C-9P     4: " C-9P    .
           MOVE B-99     TO C-9P
           IF C-9P     NOT = 0
              DISPLAY "C-9P     5: " C-9P    .
           MOVE B-P99    TO C-9P
           IF C-9P     NOT = 0
              DISPLAY "C-9P     6: " C-9P    .
           MOVE B-9PP    TO C-9P
           IF C-9P     NOT = 0
              DISPLAY "C-9P     7: " C-9P    .

           CONTINUE.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [])

AT_CLEANUP


AT_SETUP([PPP COMP-5])
AT_KEYWORDS([fundamental binary MOVE DISPLAY ADD SUBTRACT MULTIPLY DIVIDE])

# note: for changes mind the nearly identical test in data_display.at

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID. prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 XS.
         05 X-1  PIC 999PPP COMP-5  VALUE 91000.
         05 X-2  PIC 999PPP COMP-5  VALUE 92000.
         05 X-3  PIC X VALUE "$".
         05 X-4  PIC VPPP999 COMP-5 VALUE 0.000128.
       01 D-1    PIC 999PPP  COMP-5 VALUE 95000.
       01 D-2    PIC 9999PP  COMP-5 VALUE 193000.
       PROCEDURE        DIVISION.
           DISPLAY "INIT X-1 : " X-1 " .".
           DISPLAY "INIT X-2 : " X-2 " .".
           DISPLAY "INIT X-4 : " X-4 " .".
           DISPLAY "INIT D-1 : " D-1 " .".
           MOVE D-1 TO X-2 X-1
           MOVE X-2 TO D-1.
           DISPLAY "MOVE X-1 : " X-1 " .".
           DISPLAY "MOVE X-2 : " X-2 " .".
           MOVE 0.000256 TO X-4
           DISPLAY "MOVE X-4 : " X-4 " .".
           DISPLAY "MOVE D-1 : " D-1 " .".
           MOVE D-2 TO X-2 X-1
           DISPLAY "MOVE X-1 : " X-1 ":" D-2 " .".
           DISPLAY "MOVE X-2 : " X-2 ":" D-2 " .".
           MOVE 98000   TO X-1.
           IF X-1 NOT = 98000
             DISPLAY "MOVE 98000 failed: " X-1.
           MOVE 98000   TO D-1
           IF D-1 NOT = 98000
             DISPLAY "MOVE 98000 failed: " D-1.
           ADD 1000 TO X-1
           IF X-1 NOT = 99000
             DISPLAY "+ 1000 failed: " X-1.
           SUBTRACT 4000 FROM X-1.
           IF X-1 NOT = 95000
             DISPLAY "- 4000 failed: " X-1.
           DIVIDE 3 INTO X-1.
           IF X-1 NOT = 31000
             DISPLAY "/ 3 failed: " X-1.
           MULTIPLY 2 BY X-1 GIVING X-1.
           IF X-1 NOT = 62000
             DISPLAY "* 2 failed: " X-1.
           STOP RUN.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])

# CHECKME: currently the DISPLAYs all go to "real binary printing" and
# therefore no scale is printed at all; consider changing that and always
# pretty-print if requested by module
AT_CHECK([$COBCRUN_DIRECT ./prog], [0],
[INIT X-1 : 00091 .
INIT X-2 : 00092 .
INIT X-4 : 00128 .
INIT D-1 : 00095 .
MOVE X-1 : 00095 .
MOVE X-2 : 00095 .
MOVE X-4 : 00256 .
MOVE D-1 : 00095 .
MOVE X-1 : 00193:01930 .
MOVE X-2 : 00193:01930 .
], [])

AT_CLEANUP


AT_SETUP([arithmetic truncation with USAGE BINARY])
AT_KEYWORDS([fundamental COMPUTE])

# note: for changes mind the nearly identical test in data_packed.at

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID. prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       77 RESULT        PIC 9(03) BINARY.
       PROCEDURE        DIVISION.
       MAIN.
      * internal arithmetic to DISPLAY
           MOVE 1 TO RESULT
           COMPUTE RESULT = 15 + RESULT - 2 / RESULT
           IF RESULT NOT = 14
              DISPLAY "NOT 14: " RESULT.

      * internal arithmetic to DISPLAY, with sign drop
           MOVE 1 TO RESULT
           COMPUTE RESULT = 15 + RESULT - 20 / RESULT
           IF RESULT NOT = 4
              DISPLAY "NOT [-] 4: " RESULT.

      * internal arithmetic to DISPLAY with truncation of decimal-part
           MOVE 1 TO RESULT
           COMPUTE RESULT = 15 + RESULT / 2
           IF RESULT NOT = 15
              DISPLAY "NOT 15: " RESULT.

      * internal arithmetic to DISPLAY with truncation of integer-part
           MOVE 1 TO RESULT
           COMPUTE RESULT = 15 + RESULT - 2000 / RESULT
           IF RESULT NOT = 984
              DISPLAY "NOT [-1] 984: " RESULT.

      * internal arithmetic to DISPLAY with truncation of integer-part
      * with leading zeros after truncation
           MOVE 1 TO RESULT
           COMPUTE RESULT = 15 + RESULT + 2000 / RESULT
           IF RESULT NOT = 16
              DISPLAY "NOT [+20] 16: " RESULT.

           STOP RUN.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])
AT_CHECK([$COBCRUN_DIRECT ./prog], [0], [], [])

AT_CLEANUP
